<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tarot da Mikaelle</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body {
            font-family: 'Helvetica Neue', sans-serif;
            background: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            margin-bottom: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 300;
            color: #fff;
            margin-bottom: 10px;
        }

        .question-container {
            width: 100%;
            max-width: 768px;
            margin-bottom: 30px;
            padding: 0 15px;
            box-sizing: border-box;
        }

        .question-label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #9e9e9e;
        }

        #question {
            width: 100%;
            box-sizing: border-box;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #2a2a2a;
            color: #fff;
            font-size: 1.1em;
            resize: vertical;
            min-height: 60px;
            margin-bottom: 20px;
            font-family: inherit;
        }

.card-container {
       display: grid;
       grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
       gap: 0;
       padding: 0;
       width: 100%;
       max-width: 820px;
       margin: 0 auto;
       background: none;
       justify-items: center;
}



        .card-container:active {
            cursor: grabbing;
        }

        .card-container::-webkit-scrollbar {
            display: none;
        }

        .card {
            width: 50px !important;
            height: 70px !important;
            margin: 0 !important;
            padding: 0 !important;
            border-radius: 4px !important;
            cursor: pointer;
            transition: all 0.3s ease;
            object-fit: cover;
            filter: brightness(0.9);
            border: 1px solid #333;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        .card:first-child {
            margin-left: 0;
        }

        .card:hover {
          transform: translateY(-10px) scale(1.1);
          filter: brightness(1.1);
        }

        .selected-card {
            max-width: 768px;
            margin: 20px auto;
            background: rgba(42, 42, 42, 0.9);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
        }

        .selected-card img {
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .card-image-container {
            text-align: center;
        }

        .card-image-container img {
            max-width: 300px;
            height: auto;
            border-radius: 15px;
            border: 1px solid #333;
        }

        .card-image-container .card-title {
            font-size: 2em;
            color: #fff;
            margin-bottom: 20px;
        }

        .card-details {
            text-align: left;
            padding: 20px;
        }

        .card-details .question {
            color: #9e9e9e;
            font-size: 1.2em;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }

        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: 1fr;
            }
        }

        @keyframes stackCards {
            0% {
                transform: translateX(0) rotate(0deg);
            }

            100% {
                transform: translateX(50%) rotate(5deg);
            }
        }

        @keyframes spreadCards {
            0% {
                transform: translateX(50%) rotate(5deg);
                opacity: 0;
            }

            100% {
                transform: translateX(0) rotate(0deg);
                opacity: 1;
            }
        }

        .stacking {
            animation: stackCards 0.5s forwards;
        }

        .spreading {
            animation: spreadCards 0.5s forwards;
        }

        .shuffle-button {
            background: #4a4a4a;
            color: #fff;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shuffle-button:hover {
            background: #666;
            transform: translateY(-2px);
        }

        .option-container {
            margin-bottom: 20px;
        }

        .reverse-option {
            color: #9e9e9e;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reverse-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .card.reversed {
            transform: rotate(180deg);
        }

        .card.reversed:hover {
            transform: translateY(-10px) scale(1.1) rotate(180deg);
        }

        .selected-card img.reversed {
            transform: rotate(180deg);
        }

        .card {
            width: 80px;
            height: 120px;
            margin-left: -50px;
            user-select: none; /* Prevent text selection during touch */
            -webkit-user-select: none;
        }

        /* Update media queries for mobile */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .question-container {
                padding: 0 10px;
                margin-bottom: 20px;
            }

            .question-label {
                font-size: 1em;
            }

            #question {
                padding: 12px;
                font-size: 1em;
                min-height: 50px;
            }

            .option-container {
                padding: 0 10px;
                margin-bottom: 15px;
            }

            .reverse-option {
                font-size: 0.9em;
            }

            .card-container {
                width: calc(100% - 20px);
                padding: 15px;
                min-height: 140px;
            }

            .result-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .card-image-container img {
                max-width: 200px;
            }

            .card-image-container .card-title {
                font-size: 1.5em;
            }

            .card-details {
                padding: 15px;
            }

            .card-details .question {
                font-size: 1em;
            }

            /* Adjust card hover effect for touch devices */
            .card:hover {
                transform: translateY(-10px) scale(1.1);
            }

            .card.reversed:hover {
                transform: translateY(-10px) scale(1.1) rotate(180deg);
            }

        }

        /* Add specific styles for very small screens */
        @media (max-width: 380px) {
            .question-container {
                padding: 0 8px;
            }

            #question {
                padding: 10px;
                min-height: 45px;
            }

            .card {
                width: 70px;
                height: 105px;
                margin-left: -45px;
            }

            .shuffle-button {
                padding: 12px 25px;
                font-size: 1em;
            }

            .card-image-container img {
                max-width: 160px;
            }
        }

        @media (max-width: 480px) {
            .card-container {
                width: calc(100% - 20px);
                padding: 15px;
                min-height: 140px;
            }

            .card {
                width: 75px;
                height: 112px;
                margin-left: -45px;
            }
        }

        @media (max-width: 320px) {
            .card-container {
                padding: 10px;
                min-height: 100px;
            }

            .card {
                width: 60px;
                height: 90px;
                margin-left: -35px;
            }
        }

        .api-container {
            width: 100%;
            max-width: 768px;
            margin-bottom: 30px;
            padding: 0 15px;
            box-sizing: border-box;
        }

        .api-label {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
            color: #9e9e9e;
        }

        .api-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #api-key {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #333;
            border-radius: 8px;
            background: #2a2a2a;
            color: #fff;
            font-size: 1em;
            font-family: inherit;
        }

        .api-link {
            color: #4a9eff;
            text-decoration: none;
            padding: 12px 15px;
            border-radius: 8px;
            background: #2a2a2a;
            border: 1px solid #333;
            transition: all 0.3s ease;
        }

        .api-link:hover {
            background: #333;
            color: #5aafff;
        }

        @media (max-width: 768px) {
            .api-container {
                padding: 0 10px;
            }

            .api-label {
                font-size: 1em;
            }

            #api-key {
                padding: 10px 12px;
            }

            .api-link {
                padding: 10px 12px;
            }
        }

        /* Add markdown styling */
        .card-meaning {
            line-height: 1.6;
            color: #e0e0e0;
            grid-column: 1/-1;
            background: rgba(42,42,42,0.9);
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .card-meaning h1,
        .card-meaning h2,
        .card-meaning h3 {
            color: #fff;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        .card-meaning p {
            margin-bottom: 1em;
        }

        .card-meaning strong {
            color: #fff;
        }

        .card-meaning em {
            color: #b8b8b8;
        }

        .card-meaning ul,
        .card-meaning ol {
            padding-left: 1.5em;
            margin-bottom: 1em;
        }

        .card-meaning li {
            margin-bottom: 0.5em;
        }

        .card-meaning blockquote {
            border-left: 3px solid #444;
            padding-left: 1em;
            margin-left: 0;
            color: #b8b8b8;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .selected-card {
            background: rgba(42, 42, 42, 0.9);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .selected-card h2 {
            color: #fff;
            margin-bottom: 15px;
        }

        .card-meaning {
            grid-column: 1 / -1; /* Make it span all columns */
            background: rgba(42, 42, 42, 0.9);
            padding: 30px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: left;
        }

        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .card-meaning {
                margin-top: 15px;
            }
        }

        @media (min-width: 768px) {
            .result-grid {
                flex-direction: row;
                justify-content: space-between;
            }

            .selected-card {
                flex: 1;
            }
        }

        .instruction-text {
            text-align: center;
            color: #9e9e9e;
            font-size: 1.1em;
            margin: 20px 0;
            font-weight: 300;
        }

        @media (max-width: 768px) {
            .instruction-text {
                font-size: 1em;
                margin: 15px 0;
            }
        }

        .dedication {
    text-align: center;
    color: #777;
    font-size: 1.30em;
    margin-top: 40px;
    padding: 20px;
    opacity: 0.85;
}

.creator-link {
    color: #ff66cc; /* ðŸŒ¸ rosa suave â€” pode mudar! */
    text-decoration: none;
    font-weight: bold;
}

.creator-link:hover {
    color: #ff99dd;
    text-decoration: underline;
}

    </style>
</head>

<body>
    <div class="header">
        <h1>ðŸ”® Tarot da Mikaelle</h1>
    </div>

    <!-- <div class="api-container">
        <label for="api-key" class="api-label">Gemini API Key:</label>
        <div class="api-input-wrapper">
            <input type="text" id="api-key" placeholder="Enter your Gemini API key...">
            <a href="https://aistudio.google.com/apikey" target="_blank" class="api-link">Get API Key</a>
        </div>
    </div> -->

    <div class="question-container">
        <label for="question" class="question-label">O que vocÃª quer perguntar para as cartas?</label>
        <textarea id="question" placeholder="Escreva a sua pergunta aqui..."></textarea>
    </div>

    <div class="option-container">
        <label class="reverse-option">
            <input type="checkbox" checked id="allowReverse"> Permitir cartas invertidas
        </label>
    </div>

    <button id="shuffleButton" class="shuffle-button">Embaralhe e compre as cartas</button>
    <p class="instruction-text">Por favor, selecione trÃªs cartas. </p>
    <div id="result" class="selected-card" style="display: none;"></div>
    <div class="card-container" id="cardContainer"></div>

    <div class="result-grid">
        <div id="past" class="selected-card" style="display: none;"></div>
        <div id="present" class="selected-card" style="display: none;"></div>
        <div id="future" class="selected-card" style="display: none;"></div>
        <div id="card-meaning" class="card-meaning" style="display: none;"></div>
    </div>

    <script>
        var names = [
"0. O Louco", "1. O Mago", "2. A Sacerdotisa", "3. A Imperatriz", "4. O Imperador", "5. O Hierofante", "6. Os Enamorados", "7. O Carro", "8. A ForÃ§a", "9. O Eremita",
"10. A Roda da Fortuna", "11. A JustiÃ§a", "12. O Enforcado", "13. A Morte", "14. A TemperanÃ§a", "15. O Diabo", "16. A Torre", "17. A Estrela", "18. A Lua", "19. O Sol", "20. O Julgamento", "21. O Mundo",
"Dois de Copas", "TrÃªs de Copas", "Quatro de Copas", "Cinco de Copas", "Seis de Copas", "Sete de Copas", "Oito de Copas", "Nove de Copas", "Dez de Copas", "Ãs de Copas", "Rei de Copas", "Cavaleiro de Copas",
"Valete de Copas", "Rainha de Copas", "Dois de Ouros", "TrÃªs de Ouros", "Quatro de Ouros", "Cinco de Ouros", "Seis de Ouros", "Sete de Ouros", "Oito de Ouros", "Nove de Ouros", "Dez de Ouros", "Ãs de Ouros",
"Rei de Ouros", "Cavaleiro de Ouros", "Valete de Ouros", "Rainha de Ouros", "Dois de Espadas", "TrÃªs de Espadas", "Quatro de Espadas", "Cinco de Espadas", "Seis de Espadas", "Sete de Espadas", "Oito de Espadas",
"Nove de Espadas", "Dez de Espadas", "Ãs de Espadas", "Rei de Espadas", "Cavaleiro de Espadas", "Valete de Espadas", "Rainha de Espadas", "Dois de Paus", "TrÃªs de Paus", "Quatro de Paus", "Cinco de Paus",
"Seis de Paus", "Sete de Paus", "Oito de Paus", "Nove de Paus", "Dez de Paus", "Ãs de Paus",
"Rei de Paus", "Cavaleiro de Paus", "Valete de Paus", "Rainha de Paus"
];


        var images = [
            "ar00.jpg", "ar01.jpg", "ar02.jpg", "ar03.jpg", "ar04.jpg", "ar05.jpg", "ar06.jpg", "ar07.jpg",
            "ar08.jpg", "ar09.jpg", "ar10.jpg", "ar11.jpg", "ar12.jpg", "ar13.jpg", "ar14.jpg", "ar15.jpg",
            "ar16.jpg", "ar17.jpg", "ar18.jpg", "ar19.jpg", "ar20.jpg", "ar21.jpg",
            "cu02.jpg", "cu03.jpg", "cu04.jpg", "cu05.jpg", "cu06.jpg", "cu07.jpg", "cu08.jpg", "cu09.jpg",
            "cu10.jpg", "cuac.jpg", "cuki.jpg", "cukn.jpg", "cupa.jpg", "cuqu.jpg",
            "pe02.jpg", "pe03.jpg", "pe04.jpg", "pe05.jpg", "pe06.jpg", "pe07.jpg", "pe08.jpg", "pe09.jpg",
            "pe10.jpg", "peac.jpg", "peki.jpg", "pekn.jpg", "pepa.jpg", "pequ.jpg",
            "sw02.jpg", "sw03.jpg", "sw04.jpg", "sw05.jpg", "sw06.jpg", "sw07.jpg", "sw08.jpg", "sw09.jpg",
            "sw10.jpg", "swac.jpg", "swki.jpg", "swkn.jpg", "swpa.jpg", "swqu.jpg",
            "wa02.jpg", "wa03.jpg", "wa04.jpg", "wa05.jpg", "wa06.jpg", "wa07.jpg", "wa08.jpg", "wa09.jpg",
            "wa10.jpg", "waac.jpg", "waki.jpg", "wakn.jpg", "wapa.jpg", "waqu.jpg"
        ];

        const originalImages = [
            "ar00.jpg", "ar01.jpg", "ar02.jpg", "ar03.jpg", "ar04.jpg", "ar05.jpg", "ar06.jpg", "ar07.jpg",
            "ar08.jpg", "ar09.jpg", "ar10.jpg", "ar11.jpg", "ar12.jpg", "ar13.jpg", "ar14.jpg", "ar15.jpg",
            "ar16.jpg", "ar17.jpg", "ar18.jpg", "ar19.jpg", "ar20.jpg", "ar21.jpg",
            "cu02.jpg", "cu03.jpg", "cu04.jpg", "cu05.jpg", "cu06.jpg", "cu07.jpg", "cu08.jpg", "cu09.jpg",
            "cu10.jpg", "cuac.jpg", "cuki.jpg", "cukn.jpg", "cupa.jpg", "cuqu.jpg",
            "pe02.jpg", "pe03.jpg", "pe04.jpg", "pe05.jpg", "pe06.jpg", "pe07.jpg", "pe08.jpg", "pe09.jpg",
            "pe10.jpg", "peac.jpg", "peki.jpg", "pekn.jpg", "pepa.jpg", "pequ.jpg",
            "sw02.jpg", "sw03.jpg", "sw04.jpg", "sw05.jpg", "sw06.jpg", "sw07.jpg", "sw08.jpg", "sw09.jpg",
            "sw10.jpg", "swac.jpg", "swki.jpg", "swkn.jpg", "swpa.jpg", "swqu.jpg",
            "wa02.jpg", "wa03.jpg", "wa04.jpg", "wa05.jpg", "wa06.jpg", "wa07.jpg", "wa08.jpg", "wa09.jpg",
            "wa10.jpg", "waac.jpg", "waki.jpg", "wakn.jpg", "wapa.jpg", "waqu.jpg"
        ]

        const cardContainer = document.getElementById('cardContainer');
        const resultDiv = document.getElementById('result');

        let selectedCards = {
            past: null,
            present: null,
            future: null
        };

        let selectedIndices = new Set(); // Add this line after your selectedCards declaration

        function shuffleArray(array) {
            let currentIndex = array.length, randomIndex;
            const originalIndices = Array.from({ length: array.length }, (_, i) => i);

            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                [originalIndices[currentIndex], originalIndices[randomIndex]] =
                    [originalIndices[randomIndex], originalIndices[currentIndex]];
            }
            return originalIndices;
        }

        function validateQuestion() {
            const question = document.getElementById('question').value.trim();
            if (!question) {
                alert('Por favor, escreva sua pergunta primeiro antes de selecionar uma carta.');
                return false;
            }
            return true;
        }

        async function callOpenAi(question, past,present,future,past_reverse,present_reverse,future_reverse) {
            
           
            const cardMeaningElement = document.getElementById('card-meaning');
            cardMeaningElement.style.display = 'block';
            cardMeaningElement.innerHTML = 'Aguarde, a leitura das cartas estÃ¡ sendo feita...';
            
            // var apiKey = document.getElementById('api-key').value;
            // if (!apiKey) {
            //     apiKey = "";
            //     return;
            // }
            try {
                const response = await fetch("https://tarot.comquas.com/threecard", {
                    method: "POST",
                    mode: 'cors',
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        apiKey: "",
                        past: past,
                        past_reverse: past_reverse,
                        present: present,
                        present_reverse: present_reverse,
                        future: future,
                        future_reverse: future_reverse,
                        question: question,
                    })
                });

                const reader = response.body.getReader();
                let result = '';

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;

                    // Convert the Uint8Array to text
                    const chunk = new TextDecoder().decode(value);
                    result += chunk;

                    // Parse and display the accumulated markdown content
                    cardMeaningElement.innerHTML = marked.parse(result);
                }
            } catch (error) {
                cardMeaningElement.innerHTML = 'An error occurred while fetching the response.';
                console.error('Error:', error);
            }
        }

        function createCards() {
            // Reset selected indices when creating new cards
            selectedIndices.clear();
            cardContainer.innerHTML = '';
            document.getElementById('past').innerHTML = '';
            document.getElementById('present').innerHTML = '';
            document.getElementById('future').innerHTML = '';
            document.getElementById('past').style.display = 'none';
            document.getElementById('present').style.display = 'none';
            document.getElementById('future').style.display = 'none';
            document.getElementById('card-meaning').style.display = 'none';
            

            const originalIndices = shuffleArray(images);
            const allowReverse = document.getElementById('allowReverse').checked;

            images.forEach((image, index) => {
                const img = document.createElement('img');
                img.src = "./images/cover.png";
                img.className = 'card spreading';

                // Add random rotation if reverse is allowed
                if (allowReverse && Math.random() > 0.5) {
                    img.classList.add('reversed');
                }

                img.style.animationDelay = `${index * 0.05}s`;
                img.alt = "Tarot card back";
                img.dataset.index = index;
                img.dataset.originalIndex = originalIndices[index];

                img.addEventListener('click', () => {
                    if (!validateQuestion()) return;

                    const currentIndex = parseInt(img.dataset.originalIndex);
                    
                    // Check if card is already selected
                    if (selectedIndices.has(currentIndex)) {
                        return; // Don't allow selecting the same card twice
                    }

                    const isReversed = img.classList.contains('reversed');
                    const cardName = names[currentIndex];

                    // Determine which position to fill
                    let position;
                    if (!selectedCards.past) position = 'past';
                    else if (!selectedCards.present) position = 'present';
                    else if (!selectedCards.future) position = 'future';
                    else return; // All cards selected

                    // Add to selected indices
                    selectedIndices.add(currentIndex);

                    // Store selected card
                    selectedCards[position] = {
                        name: cardName,
                        image: originalImages[currentIndex],
                        isReversed: isReversed
                    };

                    // Update display
                    updateCardDisplay(position);
                    img.style.opacity = '0.5';
                    img.style.pointerEvents = 'none';

                    // If all cards are selected, show reading
                    if (selectedCards.past && selectedCards.present && selectedCards.future) {
                        showReading();
                    }
                });

                // Add touch feedback
                img.addEventListener('touchstart', () => {
                    img.style.opacity = '0.7';
                });

                img.addEventListener('touchend', () => {
                    img.style.opacity = '1';
                });

                cardContainer.appendChild(img);
            });
        }

        function updateCardDisplay(position) {
            const card = selectedCards[position];
            const positionDiv = document.getElementById(position);
            
            positionDiv.innerHTML = `
                <h2>${position.charAt(0).toUpperCase() + position.slice(1)}</h2>
                <div class="card-image-container">
                    <img src="./images/${card.image}" 
                         alt="${card.name}"
                         class="${card.isReversed ? 'reversed' : ''}">
                    <div class="card-title">
                        ${card.name}
                        ${card.isReversed ? ' (Invertida)' : ''}
                    </div>
                </div>
            `;
            positionDiv.style.display = 'block';
        }

        function showReading() {
            const question = document.getElementById('question').value;
            cardContainer.style.display = 'none';

            callOpenAi(
                question,
                selectedCards.past.name,
                selectedCards.present.name,
                selectedCards.future.name,
                selectedCards.past.isReversed,
                selectedCards.present.isReversed,
                selectedCards.future.isReversed
            );
        }

        createCards();

        document.getElementById('shuffleButton').addEventListener('click', function () {
            selectedCards = {
                past: null,
                present: null,
                future: null
            };
            selectedIndices.clear();
            createCards();
        });
        
    
    </script>
<footer class="dedication">
    By 
    <a href="https://instagram.com/SEU_INSTA" target="_blank" class="creator-link">
        Liich
    </a>
</footer>
</body>
</html>
